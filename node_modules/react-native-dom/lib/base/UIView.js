var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _wrapNativeSuper2=_interopRequireDefault(require("@babel/runtime/helpers/wrapNativeSuper"));var _debounce=_interopRequireDefault(require("debounce"));var MatrixMath=_interopRequireWildcard(require("./../utils/NativeMatrixMath"));var _UIHitSlopView=_interopRequireDefault(require("./UIHitSlopView"));var _UIChildContainerView=_interopRequireDefault(require("./UIChildContainerView"));var _UIBorderView=_interopRequireWildcard(require("./UIBorderView"));var _ColorArrayFromHexARGB=_interopRequireDefault(require("./../utils/ColorArrayFromHexARGB"));var _prefixInlineStyles=_interopRequireDefault(require("./../utils/prefixInlineStyles"));var _isIOS=_interopRequireDefault(require("./../utils/isIOS"));(function(){var styleElement=document.createElement("style");styleElement.innerHTML="\n    .pe-auto, .pe-box-only {\n      pointer-events: auto;\n    }\n    .pe-box-only > * {\n      pointer-events: none;\n    }\n    .pe-none, .pe-box-none, .pe-none * {\n      pointer-events: none !important;\n    }\n    .pe-box-none > * {\n      pointer-events: auto;\n    }\n  ";document.head&&document.head.appendChild(styleElement);})();var UIView=function(_HTMLElement){(0,_inherits2.default)(UIView,_HTMLElement);function UIView(){var _this;(0,_classCallCheck2.default)(this,UIView);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(UIView).call(this));_this._top=0;_this._left=0;_this._bottom=0;_this._right=0;_this._width=0;_this._height=0;_this._touchable=false;_this._disabled=false;_this._shadowColor=[1,0,0,0];_this._shadowOffset={width:0,height:0};_this._shadowOpacity=0;_this._shadowRadius=0;_this.isAnimatingOpacity=false;_this.handleEndedAnimatedOpacity=(0,_debounce.default)(function(){if(_this.isAnimatingOpacity){_this.removeWillChange("opacity");_this.isAnimatingOpacity=false;}},200);_this.isAnimatingTransform=false;_this.handleEndedAnimatedTransform=(0,_debounce.default)(function(){if(_this.isAnimatingTransform){_this.removeWillChange("transform");_this.isAnimatingTransform=false;}},200);_this.childContainer=new _UIChildContainerView.default();_this.appendChild(_this.childContainer);_this.reactSubviews=[];_this.hasBeenFramed=false;_this.position="absolute";_this.backgroundColor="rgba(0,0,0,0)";_this._willChangeRegistry={};_this.pointerEvents="auto";(0,_extends2.default)(_this.style,(0,_prefixInlineStyles.default)({contain:"size layout style",boxSizing:"border-box",userSelect:"inherit",overflow:"visible",touchAction:"manipulation",unicodeBidi:"embed",top:"0",left:"0"}));_UIBorderView.ALL_BORDER_PROPS.forEach(function(propName){Object.defineProperty((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(_this)),propName,{configurable:true,set:function set(value){if(propName.startsWith("border")&&propName.endsWith("Radius")){_this.style[propName]=value+"px";}_this.borderChild[propName]=value;}});});return _this;}(0,_createClass2.default)(UIView,[{key:"addWillChange",value:function addWillChange(key){if(this._willChangeRegistry.hasOwnProperty(key)){this._willChangeRegistry[key]+=1;}else{this._willChangeRegistry[key]=1;}this.updateWillChange();}},{key:"removeWillChange",value:function removeWillChange(key){if(this._willChangeRegistry.hasOwnProperty(key)){if(this._willChangeRegistry[key]===1){delete this._willChangeRegistry[key];}else{this._willChangeRegistry[key]-=1;}this.updateWillChange();}}},{key:"updateWillChange",value:function updateWillChange(){this.style.willChange=Object.keys(this._willChangeRegistry).join(", ");}},{key:"prefixStyle",value:function prefixStyle(propName,propValue){var styleObject={};if(typeof propName==="string"){styleObject[propName]=propValue;}else{styleObject=propName;}return(0,_prefixInlineStyles.default)(styleObject);}},{key:"updateHostStyle",value:function updateHostStyle(propName,propValue){(0,_extends2.default)(this.style,this.prefixStyle(propName,propValue));}},{key:"updateChildContainerStyle",value:function updateChildContainerStyle(propName,propValue){(0,_extends2.default)(this.childContainer.style,this.prefixStyle(propName,propValue));}},{key:"updateTransform",value:function updateTransform(){var transforms=[];if(this._animatedTransform){transforms.push(this._animatedTransform);}else if(this._transform){transforms.push(this._transform.length===6?"matrix("+this._transform.join(", "):"matrix3d("+this._transform.join(", ")+")");}var transformString=transforms.join(" ");this.updateHostStyle("transform",transformString);}},{key:"updateDerivedPointerEvents",value:function updateDerivedPointerEvents(){var _this2=this;if(this._prevPointerEvents!=null){this.classList.remove(this._prevPointerEvents);}var nextValue=function(){if(_this2._touchable){if(_this2._pointerEvents!=null&&["none","box-none","box-only"].includes(_this2._pointerEvents)){return"pe-"+_this2._pointerEvents;}return"pe-auto";}return"pe-box-none";}();this.classList.add(nextValue);this._prevPointerEvents=nextValue;}},{key:"attempt2d",value:function attempt2d(v){if(v[2]===0&&v[3]===0&&v[6]===0&&v[7]===0&&v[8]===0&&v[9]===0&&v[10]===1&&v[11]===0&&v[14]===0&&v[15]===1){return[v[0],v[1],v[4],v[5],v[12],v[13]];}}},{key:"updateCursor",value:function updateCursor(){var cursorValue=this._touchable&&!this._disabled?"pointer":"auto";this.updateHostStyle("cursor",cursorValue);}},{key:"updateShadow",value:function updateShadow(){var _this$_shadowColor=(0,_slicedToArray2.default)(this._shadowColor,4),r=_this$_shadowColor[1],g=_this$_shadowColor[2],b=_this$_shadowColor[3];var resolvedColor="rgba("+r+", "+g+", "+b+", "+this._shadowOpacity+")";this.updateHostStyle("boxShadow",this._shadowOffset.width+"px "+this._shadowOffset.height+"px "+this._shadowRadius+"px "+resolvedColor);}},{key:"insertReactSubviewAtIndex",value:function insertReactSubviewAtIndex(subview,index){if(index===this.reactSubviews.length){this.childContainer.appendChild(subview);}else{var beforeElement=this.reactSubviews[index];this.childContainer.insertBefore(subview,beforeElement);}this.reactSubviews.splice(index,0,subview);subview.reactSuperview=this;}},{key:"removeReactSubview",value:function removeReactSubview(subview){subview.reactSuperview=undefined;this.reactSubviews=this.reactSubviews.filter(function(s){return s!==subview;});}},{key:"purge",value:function purge(){if(this.reactSuperview){this.reactSuperview.removeReactSubview(this);}this.remove();}},{key:"addGestureRecognizer",value:function addGestureRecognizer(handler,deviceType,touchListenerOptions){this.addEventListener("pointerdown",handler.pointerBegan,touchListenerOptions);}},{key:"removeGestureRecognizer",value:function removeGestureRecognizer(handler,touchListenerOptions){this.addEventListener("pointerdown",handler.pointerBegan,touchListenerOptions);}},{key:"reactTag",get:function get(){return this._reactTag;},set:function set(value){this._reactTag=value;if(__DEV__){this.setAttribute("rct-tag",""+value);}}},{key:"frame",get:function get(){return{top:this.top,left:this.left,width:this.width,height:this.height};},set:function set(value){(0,_extends2.default)(this,value);this.childContainer.updateDimensions(value.width,value.height);if(this.borderView){this.borderView.updateDimensions(value.width,value.height);}if(!this.hasBeenFramed){this.hasBeenFramed=true;}}},{key:"position",set:function set(value){this.updateHostStyle("position",value);}},{key:"top",get:function get(){return this._top;},set:function set(value){if(value!==this._top){this._top=value;this.updateHostStyle("top",value+"px");}}},{key:"left",get:function get(){return this._left;},set:function set(value){if(value!==this._left){this._left=value;this.updateHostStyle("left",value+"px");}}},{key:"width",get:function get(){return this._width;},set:function set(value){if(value!==this._width){this._width=value;this.updateHostStyle("width",value+"px");}}},{key:"height",get:function get(){return this._height;},set:function set(value){if(value!==this._height){this._height=value;this.updateHostStyle("height",value+"px");}}},{key:"backgroundColor",set:function set(value){var resolvedValue=value;if(typeof value==="number"){var _ColorArrayFromHexARG=(0,_ColorArrayFromHexARGB.default)(value),_ColorArrayFromHexARG2=(0,_slicedToArray2.default)(_ColorArrayFromHexARG,4),a=_ColorArrayFromHexARG2[0],r=_ColorArrayFromHexARG2[1],g=_ColorArrayFromHexARG2[2],b=_ColorArrayFromHexARG2[3];var stringValue="rgba("+r+","+g+","+b+","+a+")";this._backgroundColor=stringValue;this.updateHostStyle("backgroundColor",stringValue);}else{this._backgroundColor=value;this.updateHostStyle("backgroundColor",value);}}},{key:"pointerEvents",set:function set(value){this._pointerEvents=value;this.updateDerivedPointerEvents();}},{key:"opacity",get:function get(){return this._opacity;},set:function set(value){if(this._opacity===value)return;if(!this.isAnimatingOpacity&&this._opacity!=null){this.addWillChange("opacity");this.isAnimatingOpacity=true;}this.handleEndedAnimatedOpacity();this._opacity=value;this.updateHostStyle("opacity",""+value);}},{key:"transform",get:function get(){return this._transform;},set:function set(value){if(value){var maybe2d=this.attempt2d(value);this._transform=maybe2d?maybe2d:value;}else{this._transform=[1,0,0,1,0,0];}this.updateTransform();}},{key:"animatedTransform",get:function get(){return this._animatedTransform;},set:function set(value){if(!value){this._animatedTransform="";this.updateTransform();return;}var transformString="";value.forEach(function(transformObject){Object.keys(transformObject).forEach(function(property){var value=transformObject[property];if(["translateX","translateY","translateZ"].includes(property)){transformString+=property+"("+value+"px)";}else if(["rotate","rotateX","rotateY","rotateZ"].includes(property)){transformString+=property+"("+value+"rad)";}else{transformString+=property+"("+value+")";}});});if(transformString===this._animatedTransform)return;if(!this.isAnimatingTransform){this.addWillChange("transform");this.isAnimatingTransform=true;}this.handleEndedAnimatedTransform();this._animatedTransform=transformString;this.updateTransform();}},{key:"borderChild",get:function get(){if(!this.borderView){var borderView=new _UIBorderView.default();this.appendChild(borderView);this.borderView=borderView;return borderView;}return this.borderView;}},{key:"touchable",get:function get(){return this._touchable;},set:function set(value){this._touchable=value;if(this.hitSlopView){this.hitSlopView.touchable=value;}this.updateDerivedPointerEvents();this.updateCursor();}},{key:"disabled",set:function set(value){this._disabled=value;this.updateCursor();}},{key:"zIndex",set:function set(value){this.updateHostStyle("zIndex",""+value);}},{key:"overflow",set:function set(value){if(value==="scroll")value="auto";this.updateHostStyle("overflow",value);}},{key:"backfaceVisibility",set:function set(value){this.updateHostStyle("backfaceVisibility",value);}},{key:"shadowColor",set:function set(value){var color=(0,_ColorArrayFromHexARGB.default)(value);this._shadowColor=color;this.updateShadow();}},{key:"shadowOffset",set:function set(value){this._shadowOffset=value;this.updateShadow();}},{key:"shadowOpacity",set:function set(value){this._shadowOpacity=value;this.updateShadow();}},{key:"shadowRadius",set:function set(value){this._shadowRadius=value;this.updateShadow();}},{key:"hitSlop",set:function set(value){if(value!=null){var hitSlopView=this.hitSlopView;if(hitSlopView==null){hitSlopView=new _UIHitSlopView.default(this,this._touchable);this.insertBefore(hitSlopView,this.childContainer);this.hitSlopView=hitSlopView;}hitSlopView.slop=value;}else if(this.hitSlopView!=null){this.removeChild(this.hitSlopView);this.hitSlopView=undefined;}}},{key:"direction",set:function set(value){var resolvedValue;switch(value){case"ltr":case"rtl":resolvedValue=value;break;default:resolvedValue="auto";break;}this.style.direction=resolvedValue;}}]);return UIView;}((0,_wrapNativeSuper2.default)(HTMLElement));customElements.define("ui-view",UIView);var _default=UIView;exports.default=_default;
//# sourceMappingURL=UIView.js.map