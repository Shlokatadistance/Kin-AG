var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=exports.LAYOUT_ONLY_PROPS=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var YG=_interopRequireWildcard(require("yoga-dom"));var _invariant=_interopRequireDefault(require("invariant"));var LAYOUT_PROPS=["top","left","width","height"];var LAYOUT_ONLY_PROPS=["alignSelf","alignItems","collapsable","flex","flexBasis","flexDirection","flexGrow","flexShrink","flexWrap","justifyContent","alignContent","display","right","top","bottom","left","start","end","width","height","minWidth","maxWidth","minHeight","maxHeight","margin","marginVertical","marginHorizontal","marginLeft","marginRight","marginTop","marginBottom","marginStop","marginEnd","padding","paddingVertical","paddingHorizontal","paddingLeft","paddingRight","paddingTop","paddingBottom","paddingStart","paddingEnd"];exports.LAYOUT_ONLY_PROPS=LAYOUT_ONLY_PROPS;var RCTShadowView=function(){function RCTShadowView(bridge){(0,_classCallCheck2.default)(this,RCTShadowView);this.reactSubviews=[];this.isLayoutOnly=false;this.totalNativeChildren=0;this.bridge=bridge;this.yogaNode=new bridge.Yoga.Node();this.previousLayout=undefined;this.measurement=undefined;}(0,_createClass2.default)(RCTShadowView,[{key:"isVirtual",value:function isVirtual(){return false;}},{key:"measureGlobal",value:function measureGlobal(){var globalX=0,globalY=0;var currentView=this;while(currentView){var layout=currentView.previousLayout;if(layout){globalX+=layout.left;globalY+=layout.top;if(currentView.hasOwnProperty("scrollOffset")){globalX-=currentView.scrollOffset.left;globalY-=currentView.scrollOffset.top;}currentView=currentView.reactSuperview;}else{currentView=null;}}return{globalX:globalX,globalY:globalY};}},{key:"getLayoutChanges",value:function getLayoutChanges(previousPosition){if(!this.yogaNode.hasNewLayout&&!!this.previousLayout)return[];this.yogaNode.hasNewLayout=false;var layoutChanges=[];var newLayout=this.yogaNode.getComputedLayout();var currentPosition={top:previousPosition.top+newLayout.top,left:previousPosition.left+newLayout.left};var previousMeasurement=this.measurement?(0,_objectSpread2.default)({},this.measurement):null;var nextMeasurement=(0,_objectSpread2.default)({},currentPosition,{width:newLayout.width,height:newLayout.height});if(JSON.stringify(newLayout)!==JSON.stringify(this.previousLayout)){layoutChanges.push({reactTag:this.reactTag,layout:newLayout,previousMeasurement:previousMeasurement,nextMeasurement:nextMeasurement});if(this.onLayout){this.onLayout({layout:{x:newLayout.left,y:newLayout.top,width:newLayout.width,height:newLayout.height}});}this.previousLayout=newLayout;}this.reactSubviews.forEach(function(subView){layoutChanges=layoutChanges.concat(subView.getLayoutChanges(currentPosition));});this.prevMeasurement=previousMeasurement;this.measurement=(0,_objectSpread2.default)({},nextMeasurement);return layoutChanges;}},{key:"insertReactSubviewAtIndex",value:function insertReactSubviewAtIndex(subview,index){subview.reactSuperview=this;this.reactSubviews.splice(index,0,subview);this.yogaNode.insertChild(subview.yogaNode,index);var increase=subview.isLayoutOnly?subview.totalNativeChildren:1;this.totalNativeChildren+=increase;this.updateNativeChildrenCountInParent(increase);}},{key:"removeReactSubview",value:function removeReactSubview(subview){subview.reactSuperview=undefined;this.reactSubviews=this.reactSubviews.filter(function(s){return s!==subview;});this.yogaNode.removeChild(subview.yogaNode);var decrease=subview.isLayoutOnly?subview.totalNativeChildren:1;this.totalNativeChildren-=decrease;this.updateNativeChildrenCountInParent(-decrease);}},{key:"removeAllNativeChildren",value:function removeAllNativeChildren(){this.nativeChildren=null;this.totalNativeChildren=0;}},{key:"addNativeChildAt",value:function addNativeChildAt(child,index){(0,_invariant.default)(!this.isLayoutOnly,"Cannot add native child to layoutOnly node");(0,_invariant.default)(!child.isLayoutOnly,"Cannot add layout only child as a native child");if(this.nativeChildren==null){this.nativeChildren=[];}this.nativeChildren.splice(index,0,child);child.nativeParent=this;}},{key:"removeNativeChild",value:function removeNativeChild(child){(0,_invariant.default)(this.nativeChildren,"Cannot remove native child from node which has no native children");this.nativeChildren=this.nativeChildren.filter(function(c){return c!==child;});child.nativeParent=null;}},{key:"purge",value:function purge(){this.reactSubviews.forEach(function(subView){return subView.purge();});this.yogaNode.free();}},{key:"didSetProps",value:function didSetProps(changedProps){}},{key:"didUpdateReactSubviews",value:function didUpdateReactSubviews(){}},{key:"frameContainsPoint",value:function frameContainsPoint(frame,point){return frame.left<=point.x&&point.x<=frame.left+frame.width&&frame.top<=point.y&&point.y<=frame.top+frame.height;}},{key:"reactTagAtPoint",value:function reactTagAtPoint(point){for(var _iterator=this.reactSubviews,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++];}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value;}var _shadowView=_ref;var prevLayout=_shadowView.previousLayout;if(prevLayout&&this.frameContainsPoint(prevLayout,point)){var relativePoint=(0,_objectSpread2.default)({},point);var origin={x:prevLayout.left,y:prevLayout.top};relativePoint.x-=origin.x;relativePoint.y-=origin.y;return _shadowView.reactTagAtPoint(relativePoint);}}return this.reactTag;}},{key:"updateNativeChildrenCountInParent",value:function updateNativeChildrenCountInParent(delta){if(this.isLayoutOnly){var parent=this.reactSuperview;while(parent!=null){parent.totalNativeChildren+=delta;if(!parent.isLayoutOnly){break;}parent=parent.reactSuperview;}}}},{key:"getNativeOffsetForChild",value:function getNativeOffsetForChild(child){var index=0;var found=false;for(var i=0;i<this.reactSubviews.length;i++){var current=this.reactSubviews[i];if(child===current){found=true;break;}index+=current.isLayoutOnly?current.totalNativeChildren:1;}if(!found){throw new Error("Child "+child.reactTag+" was not a child of "+this.reactTag);}return index;}},{key:"localData",set:function set(value){}},{key:"direction",set:function set(value){var constants=this.bridge.Yoga.Constants;var yogaValue;switch(value){case"ltr":yogaValue=constants.direction.ltr;break;case"rtl":yogaValue=constants.direction.rtl;break;default:yogaValue=constants.direction.inherit;break;}this._direction=yogaValue;this.yogaNode["direction"]=yogaValue;},get:function get(){return this._direction;}},{key:"hasNewLayout",get:function get(){return this.yogaNode.hasNewLayout;}},{key:"isDirty",get:function get(){return this.yogaNode.isDirty();}},{key:"backgroundColor",get:function get(){return this._backgroundColor;},set:function set(value){this._backgroundColor=value;}}]);return RCTShadowView;}();(function _callee(){var Yoga,propAlias,convertToYogaValue,setEnumProp,bindEnumProps,bindUnitProps,bindNumberProps,EDGES,bindEdgeProps;return _regenerator.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:bindEdgeProps=function _ref10(instance,propDefs,bindingFunc){propDefs.forEach(function(propName){bindingFunc.call(null,instance,EDGES.map(function(edge){return""+propName+edge;}).concat([propName]));});};bindNumberProps=function _ref9(instance,propDefs){propDefs.forEach(function(propName){Object.defineProperty(instance,propName,{configurable:true,get:function get(){return this.yogaNode[propName];},set:function set(value){if(value==null)value=Yoga.Constants.undefinedValue;this.yogaNode[propName]=value;}});});};bindUnitProps=function _ref8(instance,propDefs){propDefs.forEach(function(propName){Object.defineProperty(instance,propName,{configurable:true,get:function get(){return this.yogaNode[propName];},set:function set(value){this.yogaNode[propName]=convertToYogaValue(value,Yoga.Constants.unit);}});});};bindEnumProps=function _ref7(instance,propDefs){propDefs.forEach(function(_ref2){var _ref3=(0,_slicedToArray2.default)(_ref2,2),propName=_ref3[0],enumMap=_ref3[1];Object.defineProperty(instance,propName,{configurable:true,get:function get(){return this.yogaNode[propName];},set:function set(value){setEnumProp(this.yogaNode,propName,enumMap,value);}});});};setEnumProp=function _ref6(yogaNode,propName,enumMap,value){if(value==null){yogaNode[propName]=Yoga.Constants.undefinedValue;}else{var enumValue=enumMap[value];if(enumValue!=null){yogaNode[propName]=enumValue;}else if(__DEV__){console.warn("No such value '"+value+"' found for prop '"+propName+"'");}}};convertToYogaValue=function _ref5(input,units){if(typeof input==="number"){return{value:input,unit:units.point};}else if(input==null){return{value:Yoga.Constants.undefinedValue,unit:units.point};}if(input==="auto"){return{value:Yoga.Constants.undefinedValue,unit:units.auto};}return{value:parseFloat(input),unit:input.endsWith("%")?units.percent:units.point};};propAlias=function _ref4(target,targetProp,sourceProp){Object.defineProperty(target,targetProp,{configurable:true,get:function get(){return this[sourceProp];},set:function set(value){this[sourceProp]=value;}});};_context.next=9;return _regenerator.default.awrap(require("yoga-dom"));case 9:Yoga=_context.sent;EDGES=["Left","Right","Top","Bottom","Start","End","Horizontal","Vertical"];bindEnumProps(RCTShadowView.prototype,[["direction",Yoga.Constants.direction],["flexDirection",Yoga.Constants.flexDirection],["justifyContent",Yoga.Constants.justify],["alignContent",Yoga.Constants.align],["alignItems",Yoga.Constants.align],["alignSelf",Yoga.Constants.align],["position",Yoga.Constants.position],["flexWrap",Yoga.Constants.wrap],["overflow",Yoga.Constants.overflow],["display",Yoga.Constants.display]]);bindUnitProps(RCTShadowView.prototype,["width","height","minWidth","minHeight","maxWidth","maxHeight","left","right","top","bottom","start","end","horizontal","vertical","flexBasis"]);bindNumberProps(RCTShadowView.prototype,["flex","flexGrow","flexShrink","aspectRatio"]);bindEdgeProps(RCTShadowView.prototype,["margin","padding"],bindUnitProps);bindEdgeProps(RCTShadowView.prototype,["border"],bindNumberProps);["borderTop","borderLeft","borderRight","borderBottom","borderStart","borderEnd"].forEach(function(propName){propAlias(RCTShadowView.prototype,propName+"Width",propName);});case 17:case"end":return _context.stop();}}},null,this);})();var _default=RCTShadowView;exports.default=_default;
//# sourceMappingURL=RCTShadowView.js.map