var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _cuid=_interopRequireDefault(require("cuid"));var _invariant=_interopRequireDefault(require("invariant"));var _RCTModule2=_interopRequireDefault(require("./../bridge/RCTModule"));var kBlobURIScheme="blob";var RCTBlobManager=function(_RCTModule){(0,_inherits2.default)(RCTBlobManager,_RCTModule);function RCTBlobManager(bridge){var _this;(0,_classCallCheck2.default)(this,RCTBlobManager);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(RCTBlobManager).call(this,bridge));_this.blobs={};return _this;}(0,_createClass2.default)(RCTBlobManager,[{key:"constantsToExport",value:function constantsToExport(){return{BLOB_URI_SCHEME:kBlobURIScheme,BLOB_URI_HOST:null};}},{key:"store",value:function store(data){var blobId=(0,_cuid.default)();this.storeWithId(data,blobId);return blobId;}},{key:"storeWithId",value:function storeWithId(data,blobId){this.blobs[blobId]=data;}},{key:"resolve",value:function resolve(blob){var blobId=blob["blobId"];var offset=blob["offset"];var size=blob["size"];return this.resolveWithOffsetAndSize(blobId,offset,size);}},{key:"resolveURL",value:function resolveURL(url){var parsedUrl=new URL(url);var blobId=parsedUrl.pathname;var offset=parseInt(parsedUrl.searchParams.get("offset"),10);var size=parseInt(parsedUrl.searchParams.get("size"),10);return this.resolveWithOffsetAndSize(blobId,offset,size);}},{key:"resolveWithOffsetAndSize",value:function resolveWithOffsetAndSize(blobId,offset,size){var data=this.blobs[blobId];if(!data){return null;}if(offset!=0||size!=-1&&size!=data.size){data=data.slice(offset,offset+size);}return data;}},{key:"$addNetworkingHandler",value:function $addNetworkingHandler(){this.bridge.networking.addRequestHandler(this);this.bridge.networking.addResponseHandler(this);}},{key:"$release",value:function $release(blobId){delete this.blobs[blobId];}},{key:"canHandleNetworkingRequest",value:function canHandleNetworkingRequest(data){return data.blob!=null;}},{key:"handleNetworkingRequest",value:function handleNetworkingRequest(data){var blob=this.resolve(data.blob);(0,_invariant.default)(blob,"Could not resolve blob "+data.blob);var contentType="application/octet-stream";var blobType=blob.type;if(blobType!=null&&blob.size!==0){contentType=blob.type;}return{body:blob,contentType:contentType};}},{key:"canHandleNetworkingResponse",value:function canHandleNetworkingResponse(responseType){return responseType==="blob";}},{key:"handleNetworkingResponse",value:function handleNetworkingResponse(response,data){data=data?data:new Blob();return{blobId:this.store(data),offset:0,size:data.size,name:null,type:response.getResponseHeader("content-type")};}}]);return RCTBlobManager;}(_RCTModule2.default);RCTBlobManager.moduleName="BlobModule";var _default=RCTBlobManager;exports.default=_default;
//# sourceMappingURL=RCTBlobManager.js.map