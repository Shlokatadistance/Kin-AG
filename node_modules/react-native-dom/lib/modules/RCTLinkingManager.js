var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _RCTNativeEventEmitter=_interopRequireDefault(require("./RCTNativeEventEmitter"));var ALLOWED_PROTOCOLS=["bitcoin:","geo:","im:","irc:","ircs:","magnet:","mailto:","mms:","news:","nntp:","sip:","sms:","smsto:","ssh:","tel:","urn:","webcal:","wtai:","xmpp:"];var RCTLinkingManager=function(_RCTEventEmitter){(0,_inherits2.default)(RCTLinkingManager,_RCTEventEmitter);(0,_createClass2.default)(RCTLinkingManager,null,[{key:"locationToString",value:function locationToString(protocol,loc){return protocol+"/"+loc.pathname+loc.search+loc.hash;}}]);function RCTLinkingManager(bridge){var _this;(0,_classCallCheck2.default)(this,RCTLinkingManager);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(RCTLinkingManager).call(this,bridge));_this.handleUrlChange=function(location){_this.sendEventWithName("url",{url:decodeURIComponent(RCTLinkingManager.locationToString(_this.selfProtocol,location))});};_this.history=bridge.getModuleByName("History");_this.selfProtocol=bridge.urlScheme+":";return _this;}(0,_createClass2.default)(RCTLinkingManager,[{key:"supportedEvents",value:function supportedEvents(){return["url"];}},{key:"startObserving",value:function startObserving(){this.stopListening=this.history.listen(this.handleUrlChange);}},{key:"stopObserving",value:function stopObserving(){if(this.stopListening)this.stopListening();}},{key:"$$openURL",value:function $$openURL(url){var parsedUrl,_this$history$current,prevUrl,nextUrl;return _regenerator.default.async(function $$openURL$(_context){while(1){switch(_context.prev=_context.next){case 0:parsedUrl=new URL(url);if(!(parsedUrl.protocol===this.selfProtocol)){_context.next=7;break;}prevUrl=decodeURIComponent((_this$history$current=this.history.currentUrl)!=null?_this$history$current:"");nextUrl=""+parsedUrl.href.substr((this.selfProtocol+"/").length);if(nextUrl!==prevUrl){this.history.$push(nextUrl);}_context.next=12;break;case 7:if(!ALLOWED_PROTOCOLS.includes(parsedUrl.protocol)){_context.next=11;break;}window.location=parsedUrl.toString();_context.next=12;break;case 11:throw new Error("Cannot open URL: "+parsedUrl.toString());case 12:return _context.abrupt("return",true);case 13:case"end":return _context.stop();}}},null,this);}},{key:"$$canOpenURL",value:function $$canOpenURL(url){var _ref,protocol;return _regenerator.default.async(function $$canOpenURL$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_ref=new URL(url),protocol=_ref.protocol;return _context2.abrupt("return",[this.selfProtocol].concat(ALLOWED_PROTOCOLS).includes(protocol));case 2:case"end":return _context2.stop();}}},null,this);}},{key:"$$getInitialURL",value:function $$getInitialURL(){return _regenerator.default.async(function $$getInitialURL$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",RCTLinkingManager.locationToString(this.selfProtocol,location));case 1:case"end":return _context3.stop();}}},null,this);}}]);return RCTLinkingManager;}(_RCTNativeEventEmitter.default);RCTLinkingManager.moduleName="RCTLinkingManager";var _default=RCTLinkingManager;exports.default=_default;
//# sourceMappingURL=RCTLinkingManager.js.map