var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _RCTAnimationDriver=require("./RCTAnimationDriver");var _RCTAnimationUtils=require("./../RCTAnimationUtils");var RCTFrameAnimation=function(){function RCTFrameAnimation(animationId,config,valueNode,callback){(0,_classCallCheck2.default)(this,RCTFrameAnimation);this.animationId=animationId;this.toValue=config.toValue!=null?config.toValue:1;this.fromValue=valueNode.value;this.valueNode=valueNode;this.frames=(0,_toConsumableArray2.default)(config.frames);this.callback=callback;this.iterations=config.iterations!=null?config.iterations:1;this.currentLoop=1;this.animationHasBegun=false;this.animationHasFinished=this.iterations===0;return this;}(0,_createClass2.default)(RCTFrameAnimation,[{key:"startAnimation",value:function startAnimation(){this.animationStartTime=-1;this.animationCurrentTime=-1;this.animationHasBegun=true;}},{key:"stopAnimation",value:function stopAnimation(){if(this.callback){this.callback({finished:this.animationHasFinished});}}},{key:"stepAnimationWithTime",value:function stepAnimationWithTime(currentTime){if(!this.animationHasBegun||this.animationHasFinished||this.frames.length===0){return;}if(this.animationStartTime===-1){this.animationStartTime=this.animationCurrentTime=currentTime;}this.animationCurrentTime=currentTime;var currentDuration=this.animationCurrentTime-this.animationStartTime;var startIndex=Math.floor(currentDuration/_RCTAnimationDriver.RCTSingleFrameInterval);var nextIndex=startIndex+1;if(nextIndex>=this.frames.length){if(this.iterations==-1||this.currentLoop<this.iterations){this.animationStartTime=currentTime;this.currentLoop++;var firstValue=this.frames[0];this.updateOutputWithFrameOutput(firstValue);}else{this.animationHasFinished=true;var finalValue=this.frames[this.frames.length-1];this.updateOutputWithFrameOutput(finalValue);}return;}var fromFrameValue=this.frames[startIndex];var toFrameValue=this.frames[nextIndex];var fromInterval=startIndex*_RCTAnimationDriver.RCTSingleFrameInterval;var toInterval=nextIndex*_RCTAnimationDriver.RCTSingleFrameInterval;var frameOutput=(0,_RCTAnimationUtils.RCTInterpolateValue)(currentDuration,fromInterval,toInterval,fromFrameValue,toFrameValue,"extend","extend");this.updateOutputWithFrameOutput(frameOutput);}},{key:"updateOutputWithFrameOutput",value:function updateOutputWithFrameOutput(frameOutput){var outputValue=(0,_RCTAnimationUtils.RCTInterpolateValue)(frameOutput,0,1,this.fromValue,this.toValue,"extend","extend");var valueNode=this.valueNode;if(valueNode){valueNode.value=outputValue;valueNode.setNeedsUpdate();}}}]);return RCTFrameAnimation;}();var _default=RCTFrameAnimation;exports.default=_default;
//# sourceMappingURL=RCTFrameAnimation.js.map