var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _invariant=_interopRequireDefault(require("invariant"));var _RCTNativeEventEmitter=_interopRequireDefault(require("./RCTNativeEventEmitter"));var RCTWebSocketModule=function(_RCTEventEmitter){(0,_inherits2.default)(RCTWebSocketModule,_RCTEventEmitter);function RCTWebSocketModule(bridge){var _this;(0,_classCallCheck2.default)(this,RCTWebSocketModule);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(RCTWebSocketModule).call(this,bridge));_this.sockets={};return _this;}(0,_createClass2.default)(RCTWebSocketModule,[{key:"$connect",value:function $connect(url,protocols,options,socketId){var _this2=this;var socket=protocols?new WebSocket(url,protocols):new WebSocket(url);socket.binaryType="arraybuffer";this.sockets[String(socketId)]=socket;socket.onclose=function(event){var payload={id:socketId,code:event.code,reason:event.reason};_this2.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",["websocketClosed",payload]);};socket.onerror=function(event){var payload={id:socketId,message:"Native WebSocket error"};_this2.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",["websocketFailed",payload]);};socket.onmessage=function(event){var data=event.data;if(data instanceof ArrayBuffer){var arr=new Uint8Array(data);var str=new Array(arr.byteLength);for(var i=0;i<str.length;i++){str[i]=String.fromCharCode(arr[i]);}data=btoa(str.join(""));}var payload={id:socketId,type:typeof event.data==="string"?"string":"binary",data:data};_this2.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",["websocketMessage",payload]);};socket.onopen=function(event){var payload={id:socketId};_this2.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",["websocketOpen",payload]);};}},{key:"_send",value:function _send(data,socketId){var socket=this.sockets[String(socketId)];if(!socket){throw new Error("Error while sending data to WebSocket: no such socket");}socket.send(data);}},{key:"$send",value:function $send(data,socketId){this._send(data,socketId);}},{key:"$sendBinary",value:function $sendBinary(data,socketId){var chars=atob(data);var array=new Uint8Array(chars.length);for(var i=0;i<chars.length;i++){array[i]=chars.charCodeAt(i)&255;}this._send(array.buffer,socketId);}},{key:"$ping",value:function $ping(socketId){throw new Error("Cannot send a ping. Browser WebSocket APIs are not capable of sending specific opcodes");}},{key:"$close",value:function $close(codeOrId,reason,socketId){var id;if(typeof reason!=="undefined"&&typeof socketId!=="undefined"){id=String(socketId);var socket=this.sockets[id];if(!socket){return;}socket.close(codeOrId,reason);}else{id=String(codeOrId);var _socket=this.sockets[id];if(!_socket){return;}_socket.close();}delete this.sockets[id];}}]);return RCTWebSocketModule;}(_RCTNativeEventEmitter.default);RCTWebSocketModule.moduleName="RCTWebSocketModule";var _default=RCTWebSocketModule;exports.default=_default;
//# sourceMappingURL=RCTWebSocketModule.js.map