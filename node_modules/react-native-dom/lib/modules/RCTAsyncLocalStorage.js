var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var idbKeyval=_interopRequireWildcard(require("idb-keyval"));var _deepmerge=_interopRequireDefault(require("deepmerge"));var _RCTModule2=_interopRequireDefault(require("./../bridge/RCTModule"));var RCTAsyncLocalStorage=function(_RCTModule){(0,_inherits2.default)(RCTAsyncLocalStorage,_RCTModule);function RCTAsyncLocalStorage(){(0,_classCallCheck2.default)(this,RCTAsyncLocalStorage);return(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(RCTAsyncLocalStorage).apply(this,arguments));}(0,_createClass2.default)(RCTAsyncLocalStorage,[{key:"$multiGet",value:function $multiGet(keys,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(keys.map(function(key){return idbKeyval.get(key);})).then(function(result){callback(null,result.map(function(value,index){return[keys[index],value];}));}).catch(function(err){callback(err);});}},{key:"$multiMerge",value:function $multiMerge(kvPairs,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(kvPairs.map(function(_ref){var _ref2=(0,_slicedToArray2.default)(_ref,2),key=_ref2[0],prevValue=_ref2[1];return idbKeyval.get(key).then(function(nextValue){if(nextValue==null||typeof nextValue!=="object"){return idbKeyval.set(key,prevValue);}return idbKeyval.set(key,(0,_deepmerge.default)(prevValue,nextValue));});})).then(function(){callback();});}},{key:"$multiSet",value:function $multiSet(kvPairs,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(kvPairs.map(function(_ref3){var _ref4=(0,_slicedToArray2.default)(_ref3,2),key=_ref4[0],value=_ref4[1];return idbKeyval.set(key,value);})).then(function(){callback();});}},{key:"$multiRemove",value:function $multiRemove(keys,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(keys.map(function(key){return idbKeyval.del(key);})).then(function(){callback();});}},{key:"$getAllKeys",value:function $getAllKeys(callbackId){var callback,keys;return _regenerator.default.async(function $getAllKeys$(_context){while(1){switch(_context.prev=_context.next){case 0:callback=this.bridge.callbackFromId(callbackId);_context.prev=1;_context.next=4;return _regenerator.default.awrap(idbKeyval.keys());case 4:keys=_context.sent;callback(null,keys);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context["catch"](1);callback(_context.t0,null);case 11:case"end":return _context.stop();}}},null,this,[[1,8]]);}},{key:"$clear",value:function $clear(callbackId){var callback;return _regenerator.default.async(function $clear$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:callback=this.bridge.callbackFromId(callbackId);_context2.prev=1;_context2.next=4;return _regenerator.default.awrap(idbKeyval.clear());case 4:callback(null);_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2["catch"](1);callback(_context2.t0);case 10:case"end":return _context2.stop();}}},null,this,[[1,7]]);}}]);return RCTAsyncLocalStorage;}(_RCTModule2.default);RCTAsyncLocalStorage.moduleName="RCTAsyncLocalStorage";var _default=RCTAsyncLocalStorage;exports.default=_default;
//# sourceMappingURL=RCTAsyncLocalStorage.js.map