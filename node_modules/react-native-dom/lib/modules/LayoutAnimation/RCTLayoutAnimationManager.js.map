{"version":3,"sources":["../../../ReactDom/modules/LayoutAnimation/RCTLayoutAnimationManager.js"],"names":["PropertiesEnum","opacity","scaleXY","TypesEnum","spring","linear","easeInEaseOut","easeIn","easeOut","RCTLayoutAnimationManager","manager","reset","config","callback","pendingConfig","pendingCallback","removedNodes","addedNodes","layoutChanges","undefined","changes","forEach","addLayoutChange","bind","change","push","tag","create","update","del","delete","duration","keyframes","from","to","map","keyframe","propName","existingKeyframes","prevKeyframe","index","newValue","includes","parentKeyframes","parentKeyframe","parentValue","keyLength","layout","Array","fill","translateX","translateY","scaleX","scaleY","inverseScaleX","inverseScaleY","origin","x","width","y","height","shadowView","registry","updateKeyConfig","newFrames","view","viewRegistry","get","reactTag","reactSubviews","length","subView","subReactTag","subShadowView","shadowViewRegistry","previousLayout","hasOwnProperty","transformAnimationConfigFactory","createInverseTransformAnimationKeyframes","animations","cleanup","createKeyConfig","deleteKeyConfig","layoutChange","nextMeasurement","previousMeasurement","frame","reactSuperview","createOpacityKeyframes","delay","addWillChange","KeyframeEffect","removeWillChange","prevTop","top","prevLeft","left","prevWidth","prevHeight","nextTop","nextLeft","nextWidth","nextHeight","deltaY","createTransformAnimationKeyframes","deltaX","childContainerTransform","childContainerAnimationConfigFactory","shouldTransformChildren","prevScaleX","nextScaleX","childContainer","nextScaleY","prevScaleY","transform","style","willChange","Object","keys","parseInt","keyframeConfigs","constructTransformKeyframes","layoutStyle","removeReactSubview","purge","transformMatrix","MatrixMath","createTranslate2d","multiplyInto","scaleMatrix","createIdentityMatrix","reuseScale3dCommand","join","constructKeyframes","createTransformAnimations","groupEffect","GroupEffect","animation","document","timeline","play","finished","then","c"],"mappings":"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","sourcesContent":["/** @flow */\nimport invariant from \"invariant\";\n\nimport * as MatrixMath from \"NativeMatrixMath\";\nimport type { KeyframeResult } from \"RCTKeyframeGenerator\";\nimport RCTKeyframeGenerator from \"RCTKeyframeGenerator\";\nimport type { LayoutChange } from \"RCTShadowView\";\nimport type { Position, Frame } from \"InternalLib\";\nimport type RCTUIManager from \"RCTUIManager\";\n\nconst PropertiesEnum = {\n  opacity: true,\n  scaleXY: true\n};\n\nconst TypesEnum = {\n  spring: true,\n  linear: true,\n  easeInEaseOut: true,\n  easeIn: true,\n  easeOut: true\n};\n\nexport type LayoutAnim = {\n  duration?: number,\n  delay?: number,\n  springDamping?: number,\n  initialVelocity?: number,\n  type?: $Enum<typeof TypesEnum>,\n  property?: $Enum<typeof PropertiesEnum>\n};\n\nexport type LayoutAnimationConfig = {\n  duration: number,\n  create: LayoutAnim,\n  update: LayoutAnim,\n  delete: LayoutAnim\n};\n\ntype KeyframeConfig = {\n  create: ?KeyframeResult,\n  update: ?KeyframeResult,\n  delete: ?KeyframeResult\n};\n\ntype TransformKeyframeConfig = {\n  translateX: number,\n  translateY: number,\n  scaleX: number,\n  scaleY: number\n};\n\ntype ChildContainerKeyframeConfig = {\n  scaleX: number,\n  scaleY: number\n};\n\ntype ChildContainerAnimationConfig = ChildContainerKeyframeConfig[];\n\ntype TransformAnimationConfig = [\n  TransformKeyframeConfig[],\n  { duration: number, layout: Frame, origin: Position }\n];\n\ntype TransformAnimationConfigRegistry = {\n  [reactTag: number]: TransformAnimationConfig\n};\n\nclass RCTLayoutAnimationManager {\n  manager: RCTUIManager;\n\n  pendingConfig: ?LayoutAnimationConfig;\n  pendingCallback: ?Function;\n  removedNodes: number[];\n  addedNodes: number[];\n  layoutChanges: LayoutChange[];\n\n  constructor(manager: RCTUIManager) {\n    this.manager = manager;\n    this.reset();\n  }\n\n  configureNext(config: LayoutAnimationConfig, callback: Function) {\n    this.pendingConfig = config;\n    this.pendingCallback = callback;\n  }\n\n  reset() {\n    this.removedNodes = [];\n    this.addedNodes = [];\n    this.layoutChanges = [];\n    this.pendingConfig = undefined;\n    this.pendingCallback = undefined;\n  }\n\n  isPending(): boolean {\n    return this.pendingConfig != null;\n  }\n\n  addLayoutChanges(changes: LayoutChange[]) {\n    changes.forEach(this.addLayoutChange.bind(this));\n  }\n\n  addLayoutChange(change: LayoutChange) {\n    this.layoutChanges.push(change);\n  }\n\n  queueAddedNode(tag: number) {\n    this.addedNodes.push(tag);\n  }\n\n  queueRemovedNode(tag: number) {\n    this.removedNodes.push(tag);\n  }\n\n  constructKeyframes(config: LayoutAnimationConfig) {\n    const { create, update, delete: del, duration } = config;\n\n    const keyframes = {\n      create: RCTKeyframeGenerator(create, duration),\n      update: RCTKeyframeGenerator(update, duration),\n      delete: RCTKeyframeGenerator(del, duration)\n    };\n\n    return keyframes;\n  }\n\n  createOpacityKeyframes(\n    from: number,\n    to: number,\n    keyframes: number[]\n  ): { opacity: string }[] {\n    return keyframes.map((keyframe) => ({\n      opacity: `${to + (from - to) * (1 - keyframe)}`\n    }));\n  }\n\n  createTransformAnimationKeyframes(\n    from: number,\n    to: number,\n    keyframes: number[],\n    propName: string,\n    existingKeyframes: any[]\n  ): * {\n    return existingKeyframes.map((prevKeyframe, index) => {\n      let newValue;\n\n      if ([\"scaleX\", \"scaleY\"].includes(propName)) {\n        newValue = from + (to - from) * keyframes[index];\n\n        if (newValue <= 0) {\n          newValue = 0.0001;\n        }\n      } else {\n        newValue = from + (to - from) * keyframes[index];\n      }\n\n      return {\n        ...prevKeyframe,\n        [propName]: newValue\n      };\n    });\n  }\n\n  createInverseTransformAnimationKeyframes(\n    propName: string,\n    existingKeyframes: any[],\n    parentKeyframes: any[]\n  ): * {\n    return existingKeyframes.map((prevKeyframe, index) => {\n      const parentKeyframe = parentKeyframes[index];\n      let parentValue = parentKeyframe[propName];\n\n      let newValue;\n      if ([\"scaleX\", \"scaleY\"].includes(propName)) {\n        newValue = 1 / parentValue;\n      } else {\n        newValue = -1 * parentValue;\n      }\n\n      return {\n        ...prevKeyframe,\n        [propName]: newValue\n      };\n    });\n  }\n\n  transformAnimationConfigFactory(\n    keyLength: number,\n    duration: number,\n    layout: Frame\n  ): TransformAnimationConfig {\n    return [\n      new Array(keyLength).fill({\n        translateX: 0,\n        translateY: 0,\n        scaleX: 1.0,\n        scaleY: 1.0,\n        inverseScaleX: 1.0,\n        inverseScaleY: 1.0\n      }),\n      {\n        duration: duration,\n        layout,\n        origin: {\n          x: (-1 * layout.width) / 2,\n          y: (-1 * layout.height) / 2\n        }\n      }\n    ];\n  }\n\n  childContainerAnimationConfigFactory(keyLength: number): * {\n    return new Array(keyLength).fill({\n      scaleX: 1.0,\n      scaleY: 1.0\n    });\n  }\n\n  applyInverseTransformOnChildren(\n    shadowView: *,\n    registry: TransformAnimationConfigRegistry,\n    updateKeyConfig: KeyframeResult,\n    newFrames: TransformKeyframeConfig[],\n    propName: string\n  ) {\n    const view = this.manager.viewRegistry.get(shadowView.reactTag);\n\n    if (view && view.reactSubviews.length !== 0) {\n      view.reactSubviews.forEach((subView, index) => {\n        const subReactTag = subView.reactTag;\n\n        const subShadowView = this.manager.shadowViewRegistry.get(subReactTag);\n        invariant(subShadowView, \"Shadow View does not exist\");\n\n        const previousLayout = subShadowView.previousLayout;\n        invariant(previousLayout, \"Shadow View has no previous layout\");\n\n        if (!registry.hasOwnProperty(subReactTag)) {\n          registry[subReactTag] = this.transformAnimationConfigFactory(\n            updateKeyConfig.keyframes.length,\n            updateKeyConfig.duration,\n            previousLayout\n          );\n        }\n\n        registry[\n          subReactTag\n        ][0] = this.createInverseTransformAnimationKeyframes(\n          propName,\n          registry[subReactTag][0],\n          newFrames\n        );\n      });\n    }\n  }\n\n  createTransformAnimations(\n    keyframes: KeyframeConfig,\n    config: LayoutAnimationConfig\n  ) {\n    const animations = [];\n    const cleanup = [];\n    const registry: TransformAnimationConfigRegistry = {};\n\n    const {\n      create: createKeyConfig,\n      update: updateKeyConfig,\n      delete: deleteKeyConfig\n    } = keyframes;\n\n    const addedNodes = this.addedNodes;\n\n    this.layoutChanges.forEach((layoutChange) => {\n      const {\n        reactTag,\n        layout,\n        nextMeasurement,\n        previousMeasurement\n      } = layoutChange;\n\n      const view = this.manager.viewRegistry.get(reactTag);\n      invariant(view, \"view does not exist\");\n\n      if (addedNodes.includes(reactTag)) {\n        // skip if no creation keyframe config\n        if (createKeyConfig == null) {\n          view.frame = layout;\n          view.opacity = 1;\n          return;\n        }\n\n        // Don't animate children of added views\n        if (\n          view.reactSuperview &&\n          addedNodes.includes(view.reactSuperview.reactTag)\n        ) {\n          view.frame = layout;\n          view.opacity = 1;\n          return;\n        }\n\n        const keyframes = this.createOpacityKeyframes(\n          0,\n          1,\n          createKeyConfig.keyframes\n        );\n\n        const config = {\n          duration: createKeyConfig.duration,\n          delay: createKeyConfig.delay,\n          fill: \"none\"\n        };\n\n        view.frame = layout;\n        view.addWillChange(\"opacity\");\n\n        animations.push(new KeyframeEffect(view, keyframes, config));\n        cleanup.push(() => {\n          view.removeWillChange(\"opacity\");\n        });\n      } else {\n        // skip layout update animation\n        if (updateKeyConfig == null) {\n          view.frame = layout;\n          return;\n        }\n\n        const shadowView = this.manager.shadowViewRegistry.get(reactTag);\n        invariant(\n          shadowView,\n          `shadowView does not exist with tag: ${reactTag}`\n        );\n\n        if (!registry.hasOwnProperty(reactTag)) {\n          registry[reactTag] = this.transformAnimationConfigFactory(\n            updateKeyConfig.keyframes.length,\n            updateKeyConfig.duration,\n            layout\n          );\n        }\n\n        let {\n          top: prevTop,\n          left: prevLeft,\n          width: prevWidth,\n          height: prevHeight\n        } = view.frame;\n\n        let {\n          top: nextTop,\n          left: nextLeft,\n          width: nextWidth,\n          height: nextHeight\n        } = layout;\n\n        if (prevTop !== nextTop) {\n          const deltaY = prevTop - nextTop;\n          const newFrames = this.createTransformAnimationKeyframes(\n            deltaY,\n            0,\n            updateKeyConfig.keyframes,\n            \"translateY\",\n            registry[reactTag][0]\n          );\n\n          registry[reactTag][0] = newFrames;\n        }\n\n        if (prevLeft !== nextLeft) {\n          const deltaX = prevLeft - nextLeft;\n          const newFrames = this.createTransformAnimationKeyframes(\n            deltaX,\n            0,\n            updateKeyConfig.keyframes,\n            \"translateX\",\n            registry[reactTag][0]\n          );\n\n          registry[reactTag][0] = newFrames;\n        }\n\n        let childContainerTransform = this.childContainerAnimationConfigFactory(\n          updateKeyConfig.keyframes.length\n        );\n        let shouldTransformChildren = false;\n\n        if (prevWidth !== nextWidth && nextWidth !== 0) {\n          const prevScaleX = prevWidth / nextWidth;\n          const nextScaleX = 1.0;\n\n          const newFrames = this.createTransformAnimationKeyframes(\n            prevScaleX,\n            nextScaleX,\n            updateKeyConfig.keyframes,\n            \"scaleX\",\n            registry[reactTag][0]\n          );\n\n          registry[reactTag][0] = newFrames;\n\n          if (view.childContainer) {\n            shouldTransformChildren = true;\n            childContainerTransform = this.createInverseTransformAnimationKeyframes(\n              \"scaleX\",\n              childContainerTransform,\n              newFrames\n            );\n          }\n        }\n\n        if (prevHeight !== nextHeight && nextHeight !== 0) {\n          const nextScaleY = 1.0;\n          const prevScaleY = prevHeight / nextHeight;\n\n          const newFrames = this.createTransformAnimationKeyframes(\n            prevScaleY,\n            nextScaleY,\n            updateKeyConfig.keyframes,\n            \"scaleY\",\n            registry[reactTag][0]\n          );\n\n          registry[reactTag][0] = newFrames;\n\n          if (view.childContainer) {\n            shouldTransformChildren = true;\n            childContainerTransform = this.createInverseTransformAnimationKeyframes(\n              \"scaleY\",\n              childContainerTransform,\n              newFrames\n            );\n          }\n        }\n\n        if (shouldTransformChildren) {\n          const childContainer = view.childContainer;\n          if (childContainer) {\n            const keyframes = childContainerTransform.map(\n              ({ scaleX, scaleY }) => ({\n                transform: `scale(${scaleX},${scaleY})`\n              })\n            );\n            const config = { duration: updateKeyConfig.duration, fill: \"none\" };\n\n            childContainer.style.willChange = \"transform\";\n            animations.push(\n              new KeyframeEffect(childContainer, keyframes, config)\n            );\n            cleanup.push(() => {\n              childContainer.style.willChange = \"\";\n            });\n          }\n        }\n      }\n    });\n\n    Object.keys(registry).forEach((tag) => {\n      const reactTag = parseInt(tag, 10);\n\n      const [keyframeConfigs, { duration, layout, origin }] = registry[\n        reactTag\n      ];\n\n      const view = this.manager.viewRegistry.get(reactTag);\n      invariant(view, \"view does not exist\");\n\n      const keyframes = this.constructTransformKeyframes(\n        keyframeConfigs,\n        origin\n      );\n\n      const layoutStyle = {\n        top: layout.top,\n        left: layout.left,\n        width: `${layout.width}px`,\n        height: `${layout.height}px`\n      };\n\n      const config = { duration, fill: \"none\" };\n\n      view.addWillChange(\"transform\");\n      view.frame = layout;\n      animations.push(new KeyframeEffect(view, keyframes, config));\n      cleanup.push(() => {\n        view.removeWillChange(\"transform\");\n      });\n    });\n\n    // Animate view removal\n    this.removedNodes.forEach((reactTag) => {\n      const view = this.manager.viewRegistry.get(reactTag);\n      invariant(view, \"view does not exist\");\n\n      if (deleteKeyConfig == null) {\n        if (view.reactSuperview) {\n          view.reactSuperview.removeReactSubview(view);\n        }\n        this.manager.viewRegistry.delete(reactTag);\n        view.purge();\n        return;\n      }\n\n      if (\n        view.reactSuperview &&\n        this.removedNodes.includes(view.reactSuperview.reactTag)\n      ) {\n        if (view.reactSuperview) {\n          view.reactSuperview.removeReactSubview(view);\n        }\n        this.manager.viewRegistry.delete(reactTag);\n        return;\n      }\n\n      const keyframes = this.createOpacityKeyframes(\n        1,\n        0,\n        deleteKeyConfig.keyframes\n      );\n\n      const config = {\n        duration: deleteKeyConfig.duration,\n        delay: deleteKeyConfig.delay,\n        fill: \"forwards\"\n      };\n\n      view.addWillChange(\"opacity\");\n      animations.push(new KeyframeEffect(view, keyframes, config));\n      cleanup.push(() => {\n        if (view.reactSuperview) {\n          view.reactSuperview.removeReactSubview(view);\n        }\n        this.manager.viewRegistry.delete(reactTag);\n        view.purge();\n      });\n    });\n\n    return [animations, cleanup];\n  }\n\n  constructTransformKeyframes(\n    keyframeConfigs: TransformKeyframeConfig[],\n    origin: Position\n  ): * {\n    return keyframeConfigs.map((config) => {\n      const { translateX, translateY, scaleX, scaleY } = config;\n\n      // shift transformation origin\n      let transformMatrix = MatrixMath.createTranslate2d(origin.x, origin.y);\n\n      // apply translation\n      MatrixMath.multiplyInto(\n        transformMatrix,\n        transformMatrix,\n        MatrixMath.createTranslate2d(translateX, translateY)\n      );\n\n      // apply scaling\n      const scaleMatrix = MatrixMath.createIdentityMatrix();\n      MatrixMath.reuseScale3dCommand(scaleMatrix, scaleX, scaleY, 1.0);\n      MatrixMath.multiplyInto(transformMatrix, transformMatrix, scaleMatrix);\n\n      // revert transformation origin\n      MatrixMath.multiplyInto(\n        transformMatrix,\n        transformMatrix,\n        MatrixMath.createTranslate2d(-origin.x, -origin.y)\n      );\n\n      return {\n        transform: `matrix3d(${transformMatrix.join(\", \")})`\n      };\n    });\n  }\n\n  applyLayoutChanges() {\n    const pendingConfig = this.pendingConfig;\n    const layoutChanges = this.layoutChanges;\n    const callback = this.pendingCallback;\n\n    invariant(\n      pendingConfig && layoutChanges && callback,\n      \"Attempting to apply a layoutanimation without a pending config.\"\n    );\n\n    const keyframes = this.constructKeyframes(pendingConfig);\n    const [animations, cleanup] = this.createTransformAnimations(\n      keyframes,\n      pendingConfig\n    );\n\n    const groupEffect = new GroupEffect(animations);\n\n    // $FlowFixMe: libdef\n    const animation = document.timeline.play(groupEffect);\n    animation.finished.then(() => {\n      cleanup.forEach((c) => c());\n      callback();\n    });\n\n    this.reset();\n  }\n}\n\nexport default RCTLayoutAnimationManager;\n"],"file":"RCTLayoutAnimationManager.js"}