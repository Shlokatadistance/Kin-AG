{"version":3,"sources":["../../ReactDom/bridge/RCTRootView.js"],"names":["RCTRootView","bundle","moduleName","parent","enableHotReload","urlScheme","basename","nativeModules","requestTick","ticking","window","requestAnimationFrame","renderLoop","bind","bundleLocation","updateHostStyle","setAttribute","bridge","RCTBridge","initialization","initializeBridge","bundleFinishedLoading","Yoga","yoga","initializeModules","deviceInfoModule","modulesByName","dimensions","exportedDimensions","availableSize","width","height","uiManager","timing","touchHandler","RCTTouchHandler","attachToView","WebkitTapHighlightColor","userSelect","overflow","position","i18nModule","direction","NotificationCenter","addListener","DIRECTION_CHANGE_EVENT","runApplication","appParameters","rootTag","reactTag","initialProps","enqueueJSCall","__DEV__","bundleURL","URL","console","warn","pathname","toString","substr","hostname","port","frameStart","performance","now","Date","frame","idle","shouldContinue","setTimeout","appendChild","loadBridgeConfig","_reactTag","allocateRootTag","registerRootView","value","UIView","customElements","define"],"mappings":"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","sourcesContent":["/** @flow */\n\nimport Yoga from \"yoga-dom\";\n\nimport type { Size } from \"InternalLib\";\nimport RCTBridge from \"RCTBridge\";\nimport UIView from \"UIView\";\nimport NotificationCenter from \"NotificationCenter\";\nimport RCTDeviceInfo from \"RCTDeviceInfo\";\nimport RCTTiming from \"RCTTiming\";\nimport RCTTouchHandler from \"RCTTouchHandler\";\nimport instrument from \"Instrument\";\nimport type { Frame } from \"InternalLib\";\nimport { DIRECTION_CHANGE_EVENT } from \"RCTI18nManager\";\nimport type RCTI18nManager from \"RCTI18nManager\";\nimport type { NativeModuleImports } from \"RCTModule\";\n\ndeclare var __DEV__: boolean;\n\nclass RCTRootView extends UIView {\n  _reactTag: number;\n\n  bridge: RCTBridge;\n  moduleName: string;\n  availableSize: Size;\n  parent: HTMLElement;\n  uiManager: *;\n  timing: RCTTiming;\n  ticking: boolean;\n  bundleLocation: string;\n  enableHotReload: boolean;\n\n  touchHandler: RCTTouchHandler;\n\n  initialization: Promise<void>;\n\n  constructor(\n    bundle: string,\n    moduleName: string,\n    parent: HTMLElement,\n    enableHotReload: boolean = false,\n    urlScheme: string,\n    basename: string,\n    nativeModules: NativeModuleImports\n  ) {\n    super();\n\n    this.bundleLocation = bundle;\n    this.enableHotReload = enableHotReload;\n    this.moduleName = moduleName;\n    this.parent = parent;\n\n    if (this.enableHotReload) {\n      bundle += \"&hot=true\";\n    }\n\n    this.updateHostStyle(\"touchAction\", \"none\");\n    this.setAttribute(\"touch-action\", \"none\");\n\n    const bridge = new RCTBridge(\n      moduleName,\n      bundle,\n      nativeModules,\n      parent,\n      urlScheme,\n      basename\n    );\n    this.initialization = this.initializeBridge(bridge);\n  }\n\n  async initializeBridge(bridge: RCTBridge) {\n    this.bridge = bridge;\n    this.bridge.bundleFinishedLoading = this.bundleFinishedLoading.bind(this);\n\n    const yoga = await Yoga;\n    this.bridge.Yoga = yoga;\n    await this.bridge.initializeModules();\n\n    const deviceInfoModule: RCTDeviceInfo = (this.bridge.modulesByName[\n      \"DeviceInfo\"\n    ]: any);\n\n    const dimensions = deviceInfoModule.exportedDimensions().window;\n    this.availableSize = {\n      width: dimensions.width,\n      height: dimensions.height\n    };\n\n    this.width = this.availableSize.width;\n    this.height = this.availableSize.height;\n\n    this.uiManager = this.bridge.uiManager;\n    this.timing = (this.bridge.modulesByName[\"Timing\"]: any);\n\n    this.touchHandler = new RCTTouchHandler(this.bridge);\n    this.touchHandler.attachToView(this);\n\n    this.updateHostStyle({\n      WebkitTapHighlightColor: \"transparent\",\n      userSelect: \"none\",\n      overflow: \"hidden\",\n      position: \"absolute\"\n    });\n\n    this.ticking = false;\n\n    const i18nModule: RCTI18nManager = (this.bridge.modulesByName[\n      \"I18nManager\"\n    ]: any);\n\n    this.direction = i18nModule.direction;\n\n    NotificationCenter.addListener(DIRECTION_CHANGE_EVENT, ({ direction }) => {\n      this.direction = direction;\n    });\n  }\n\n  get reactTag(): number {\n    if (!this._reactTag) {\n      const reactTag = this.uiManager.allocateRootTag;\n      super.reactTag = reactTag;\n      this.uiManager.registerRootView(this);\n    }\n    return this._reactTag;\n  }\n\n  set reactTag(value: number) {}\n\n  bundleFinishedLoading() {\n    this.runApplication();\n  }\n\n  runApplication() {\n    const appParameters = {\n      rootTag: this.reactTag,\n      initialProps: {}\n    };\n\n    this.bridge.enqueueJSCall(\"AppRegistry\", \"runApplication\", [\n      this.moduleName,\n      appParameters\n    ]);\n\n    if (__DEV__ && this.enableHotReload) {\n      const bundleURL = new URL(this.bundleLocation);\n      console.warn(\"HotReload on \" + this.bundleLocation);\n      this.bridge.enqueueJSCall(\"HMRClient\", \"enable\", [\n        \"dom\",\n        bundleURL.pathname.toString().substr(1),\n        bundleURL.hostname,\n        bundleURL.port\n      ]);\n    }\n\n    this.requestTick();\n  }\n\n  requestTick = () => {\n    if (!this.ticking) {\n      window.requestAnimationFrame(this.renderLoop.bind(this));\n    }\n    this.ticking = true;\n  };\n\n  async renderLoop() {\n    this.ticking = false;\n\n    const frameStart = window.performance ? performance.now() : Date.now();\n\n    await instrument(\"⚛️ Timing\", () => this.timing.frame());\n    await instrument(\"⚛️ Bridge\", () => this.bridge.frame());\n    await instrument(\"⚛️ Rendering\", () => this.uiManager.frame());\n\n    await this.timing.idle(frameStart);\n\n    if (\n      this.timing.shouldContinue() ||\n      this.bridge.shouldContinue() ||\n      this.uiManager.shouldContinue()\n    ) {\n      this.requestTick();\n    } else {\n      // Only ocasionally check for updates from the react thread\n      // (this is just a sanity check and shouldn't really be necessary)\n      window.setTimeout(this.requestTick, 1000);\n    }\n  }\n\n  async render() {\n    await this.initialization;\n\n    this.parent.appendChild(this);\n    this.bridge.loadBridgeConfig();\n    this.requestTick();\n  }\n}\n\ncustomElements.define(\"rct-root-view\", RCTRootView);\n\nexport default RCTRootView;\n"],"file":"RCTRootView.js"}