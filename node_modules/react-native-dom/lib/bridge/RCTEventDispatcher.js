var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.normalizeInputEventName=normalizeInputEventName;exports.default=exports.RCTTextEventType=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _objectSpread2=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _invariant=_interopRequireDefault(require("invariant"));var _RCTModule2=_interopRequireDefault(require("./RCTModule"));var RCTTextEventType={RCTTextEventTypeFocus:0,RCTTextEventTypeBlur:1,RCTTextEventTypeChange:2,RCTTextEventTypeSubmit:3,RCTTextEventTypeEnd:4,RCTTextEventTypeKeyPress:5};exports.RCTTextEventType=RCTTextEventType;function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1);}function normalizeInputEventName(eventName){if(eventName.startsWith("on")){eventName="top"+eventName.substring(2);}else if(!eventName.startsWith("top")){eventName="top"+capitalizeFirstLetter(eventName);}return eventName;}function stringToHash(input){var hash=0,chr;if(input.length===0)return hash;for(var i=0;i<input.length;i++){chr=input.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0;}return hash;}var RCTEventDispatcher=function(_RCTModule){(0,_inherits2.default)(RCTEventDispatcher,_RCTModule);(0,_createClass2.default)(RCTEventDispatcher,null,[{key:"RCTGetEventID",value:function RCTGetEventID(event){return event.viewTag|(stringToHash(event.eventName)&0xffff)<<32|event.coalescingKey<<48;}}]);function RCTEventDispatcher(bridge){var _this;(0,_classCallCheck2.default)(this,RCTEventDispatcher);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(RCTEventDispatcher).call(this,bridge));_this.events={};_this.eventQueue=[];_this.eventsDispatchScheduled=false;_this.observers=new Set();return _this;}(0,_createClass2.default)(RCTEventDispatcher,[{key:"sendDeviceEvent",value:function sendDeviceEvent(name,body){this.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",body?[name,body]:[name]);}},{key:"sendInputEvent",value:function sendInputEvent(name,body){name=normalizeInputEventName(name);this.bridge.enqueueJSCall("RCTEventEmitter","receiveEvent",[body.target,name,body]);}},{key:"sendTextEvent",value:function sendTextEvent(type,reactTag,text,key,eventCount){var events=["focus","blur","change","submitEditing","endEditing","keyPress"];var body={eventCount:eventCount,target:reactTag};if(text){body.text=text;}if(key){}this.sendInputEvent(events[type],body);}},{key:"sendEvent",value:function sendEvent(event){for(var _iterator=this.observers,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++];}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value;}var _observer=_ref;_observer.eventDispatcherWillDispatchEvent(event);}var eventID=RCTEventDispatcher.RCTGetEventID(event);var previousEvent=this.events[eventID];if(previousEvent){(0,_invariant.default)(event.canCoalesce(),"Got event which cannot be coalesced, but has the same eventID "+eventID+" as the previous event");event=previousEvent.coalesceWithEvent(previousEvent);}else{this.eventQueue.push(eventID);}this.events[eventID]=event;var scheduleEventsDispatch=false;if(!this.eventsDispatchScheduled){this.eventsDispatchScheduled=true;scheduleEventsDispatch=true;}if(scheduleEventsDispatch){this.flushEventsQueue();}}},{key:"dispatchEvent",value:function dispatchEvent(event){this.bridge.enqueueJSCallWithDotMethod(event.moduleDotMethod(),event.arguments());}},{key:"flushEventsQueue",value:function flushEventsQueue(){var _this2=this;var events=(0,_objectSpread2.default)({},this.events);this.events={};var eventQueue=(0,_toConsumableArray2.default)(this.eventQueue);this.eventQueue=[];this.eventsDispatchScheduled=false;eventQueue.forEach(function(eventId){_this2.dispatchEvent(events[eventId]);});}},{key:"addDispatchObserver",value:function addDispatchObserver(observer){this.observers.add(observer);}},{key:"removeDispatchObserver",value:function removeDispatchObserver(observer){this.observers.delete(observer);}}]);return RCTEventDispatcher;}(_RCTModule2.default);RCTEventDispatcher.moduleName="RCTEventDispatcher";var _default=RCTEventDispatcher;exports.default=_default;
//# sourceMappingURL=RCTEventDispatcher.js.map