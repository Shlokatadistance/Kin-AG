var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _set2=_interopRequireDefault(require("@babel/runtime/helpers/set"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _yogaDom=_interopRequireDefault(require("yoga-dom"));var _RCTBridge=_interopRequireDefault(require("./RCTBridge"));var _UIView2=_interopRequireDefault(require("./../base/UIView"));var _NotificationCenter=_interopRequireDefault(require("./../base/NotificationCenter"));var _RCTDeviceInfo=_interopRequireDefault(require("./../modules/RCTDeviceInfo"));var _RCTTiming=_interopRequireDefault(require("./../modules/RCTTiming"));var _RCTTouchHandler=_interopRequireDefault(require("./../modules/RCTTouchHandler"));var _Instrument=_interopRequireDefault(require("./../utils/Instrument"));var _RCTI18nManager=require("./../modules/RCTI18nManager");var RCTRootView=function(_UIView){(0,_inherits2.default)(RCTRootView,_UIView);function RCTRootView(bundle,moduleName,parent){var _this;var enableHotReload=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var urlScheme=arguments.length>4?arguments[4]:undefined;var basename=arguments.length>5?arguments[5]:undefined;var nativeModules=arguments.length>6?arguments[6]:undefined;(0,_classCallCheck2.default)(this,RCTRootView);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(RCTRootView).call(this));_this.requestTick=function(){if(!_this.ticking){window.requestAnimationFrame(_this.renderLoop.bind((0,_assertThisInitialized2.default)((0,_assertThisInitialized2.default)(_this))));}_this.ticking=true;};_this.bundleLocation=bundle;_this.enableHotReload=enableHotReload;_this.moduleName=moduleName;_this.parent=parent;if(_this.enableHotReload){bundle+="&hot=true";}_this.updateHostStyle("touchAction","none");_this.setAttribute("touch-action","none");var bridge=new _RCTBridge.default(moduleName,bundle,nativeModules,parent,urlScheme,basename);_this.initialization=_this.initializeBridge(bridge);return _this;}(0,_createClass2.default)(RCTRootView,[{key:"initializeBridge",value:function initializeBridge(bridge){var _this2=this;var yoga,deviceInfoModule,dimensions,i18nModule;return _regenerator.default.async(function initializeBridge$(_context){while(1){switch(_context.prev=_context.next){case 0:this.bridge=bridge;this.bridge.bundleFinishedLoading=this.bundleFinishedLoading.bind(this);_context.next=4;return _regenerator.default.awrap(_yogaDom.default);case 4:yoga=_context.sent;this.bridge.Yoga=yoga;_context.next=8;return _regenerator.default.awrap(this.bridge.initializeModules());case 8:deviceInfoModule=this.bridge.modulesByName["DeviceInfo"];dimensions=deviceInfoModule.exportedDimensions().window;this.availableSize={width:dimensions.width,height:dimensions.height};this.width=this.availableSize.width;this.height=this.availableSize.height;this.uiManager=this.bridge.uiManager;this.timing=this.bridge.modulesByName["Timing"];this.touchHandler=new _RCTTouchHandler.default(this.bridge);this.touchHandler.attachToView(this);this.updateHostStyle({WebkitTapHighlightColor:"transparent",userSelect:"none",overflow:"hidden",position:"absolute"});this.ticking=false;i18nModule=this.bridge.modulesByName["I18nManager"];this.direction=i18nModule.direction;_NotificationCenter.default.addListener(_RCTI18nManager.DIRECTION_CHANGE_EVENT,function(_ref){var direction=_ref.direction;_this2.direction=direction;});case 22:case"end":return _context.stop();}}},null,this);}},{key:"bundleFinishedLoading",value:function bundleFinishedLoading(){this.runApplication();}},{key:"runApplication",value:function runApplication(){var appParameters={rootTag:this.reactTag,initialProps:{}};this.bridge.enqueueJSCall("AppRegistry","runApplication",[this.moduleName,appParameters]);if(__DEV__&&this.enableHotReload){var bundleURL=new URL(this.bundleLocation);console.warn("HotReload on "+this.bundleLocation);this.bridge.enqueueJSCall("HMRClient","enable",["dom",bundleURL.pathname.toString().substr(1),bundleURL.hostname,bundleURL.port]);}this.requestTick();}},{key:"renderLoop",value:function renderLoop(){var _this3=this;var frameStart;return _regenerator.default.async(function renderLoop$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.ticking=false;frameStart=window.performance?performance.now():Date.now();_context2.next=4;return _regenerator.default.awrap((0,_Instrument.default)("⚛️ Timing",function(){return _this3.timing.frame();}));case 4:_context2.next=6;return _regenerator.default.awrap((0,_Instrument.default)("⚛️ Bridge",function(){return _this3.bridge.frame();}));case 6:_context2.next=8;return _regenerator.default.awrap((0,_Instrument.default)("⚛️ Rendering",function(){return _this3.uiManager.frame();}));case 8:_context2.next=10;return _regenerator.default.awrap(this.timing.idle(frameStart));case 10:if(this.timing.shouldContinue()||this.bridge.shouldContinue()||this.uiManager.shouldContinue()){this.requestTick();}else{window.setTimeout(this.requestTick,1000);}case 11:case"end":return _context2.stop();}}},null,this);}},{key:"render",value:function render(){return _regenerator.default.async(function render$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regenerator.default.awrap(this.initialization);case 2:this.parent.appendChild(this);this.bridge.loadBridgeConfig();this.requestTick();case 5:case"end":return _context3.stop();}}},null,this);}},{key:"reactTag",get:function get(){if(!this._reactTag){var reactTag=this.uiManager.allocateRootTag;(0,_set2.default)((0,_getPrototypeOf2.default)(RCTRootView.prototype),"reactTag",reactTag,this,true);this.uiManager.registerRootView(this);}return this._reactTag;},set:function set(value){}}]);return RCTRootView;}(_UIView2.default);customElements.define("rct-root-view",RCTRootView);var _default=RCTRootView;exports.default=_default;
//# sourceMappingURL=RCTRootView.js.map